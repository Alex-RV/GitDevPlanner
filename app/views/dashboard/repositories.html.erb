<div class="container mx-auto py-8 px-4">
  <% if @repos_data.any? %>
    <h2 class="text-2xl font-semibold mb-4">Repositories</h2>
    <ol class="list-decimal pl-6 mb-8">
      <% @repos_data.each do |repo| %>
        <li class="mb-6 border-b pb-4">
          <h3 class="text-xl font-semibold mb-2"><%= repo.name %></h3>
          <ul>
            <li><strong>Owner:</strong> <%= repo.owner_login %></li>
            <li><strong>URL:</strong> <%= repo.html_url %></li>
            <li><strong>Private Status:</strong> <%= repo.private ? 'Private' : 'Public' %></li>
            <li>
              <strong>Last non-code related updates:</strong>
              <%= repo.updated_repo_at.in_time_zone('Pacific Time (US & Canada)').strftime('%B %e, %Y %l:%M%P') %>
            </li>
            <li>
              <strong>Last code related updates:</strong>
              <%= repo.pushed_at.in_time_zone('Pacific Time (US & Canada)').strftime('%B %e, %Y %l:%M%P') %>
            </li>
            <% if repo.last_commit_message %>
              <li>
                <strong>Last commit:</strong>
                <%= repo.last_commit_date.in_time_zone('Pacific Time (US & Canada)').strftime('%B %e, %Y %l:%M%P') %>
              </li>
              <li><strong>Commit Message:</strong> <%= repo.last_commit_message %></li>
              <li><strong>Commit Author:</strong> <%= repo.last_commit_author %></li>
            <% else %>
              <li><strong>No commits found for this repository.</strong></li>
            <% end %>
          </ul>

          <% repo_tasks = @tasks.select { |task| task.repository_id == repo.id } %>
          <% if repo_tasks.any? %>
            <h4 class="text-lg font-semibold mb-2 mt-4">Tasks:</h4>
            <ul class="list-disc pl-6">
              <% repo_tasks.each do |task| %>
                <li class="flex justify-between items-center border rounded px-4 py-2 mt-2 hover:bg-gray-100">
                  <div>
                    <strong>Title:</strong> <%= task.title %>
                    <br>
                    <strong>Description:</strong> <%= task.description %>
                  </div>
                  <%= button_to 'Delete Task', delete_task_path(task), method: :delete, data: { confirm: 'Are you sure you want to delete this task?' }, class: 'btn-primary ml-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded' %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="mt-4">No tasks associated with this repository.</p>
          <% end %>

          <div class="mt-6">
            <%= form_with(model: Task.new, url: create_task_path, method: :post, class: 'space-y-4') do |form| %>
              <%= form.hidden_field :repository_id, value: repo.id %>

              <div class="flex flex-col">
                <%= form.label :title, class: 'font-semibold' %>
                <%= form.text_field :title, class: 'form-input mt-1' %>
              </div>

              <div class="flex flex-col">
                <%= form.label :description, class: 'font-semibold' %>
                <%= form.text_area :description, class: 'form-textarea mt-1' %>
              </div>

              <div class="flex justify-end">
                <%= form.submit 'Create Task', class: 'btn-primary py-2 px-4 rounded text-white font-semibold bg-green-600 hover:bg-green-700' %>
              </div>
            <% end %>
          </div>

        </li>
      <% end %>
    </ol>
  <% else %>
    <p>No repositories found.</p>
  <% end %>
</div>
